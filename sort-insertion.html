<!DOCTYPE HTML>
<html>
    <head>
        <title>Testbed for Insertion Sort Implementation</title>
        <!--
          - YUI Test Dependencies (YUI 2.8.0)
          -->
        <link rel="stylesheet" type="text/css" href="./yui/logger.css">
        <link rel="stylesheet" type="text/css" href="./yui/testlogger.css">
        <script type="text/javascript" src="./yui/yahoo-dom-event.js"></script>
        <script type="text/javascript" src="./yui/logger-min.js"></script>
        <script type="text/javascript" src="./yui/yuitest-min.js"></script>

        <!--
          - Insertion Sort Code: Based on discussion in "Introduction to Algorithms"
          -->
        <script>
            var DEBUG = false;

            /**
             *  Create a string to display the values of an array.
             *  
             *  I ran into timing issues with `console.log`'s Array display
             *  in webkit.  Rolling my own solves the problem (which I still
             *  don't actually understand...)
            **/
            Array.prototype.print = function() {
                var output = "[ ", i = 0;
                for ( i = 0; i < this.length; i += 1 ) {
                    output += (( i ) ? ", " : "" ) + "`" + this[ i ] + "`";
                }
                output += " ]";
                return output;
            };

            Array.prototype.insertionsort = ( function() {
                var _insertionsort, _exchange;

                _insertionsort  = function ( a, cmp ) {
                    DEBUG && console.log( "        _insertionsort called on %s", a.print() );

                    var sorted_partition, key, current_index;
                    for ( sorted_partition = 1; sorted_partition < a.length; sorted_partition += 1 ) {
                        current_index   = sorted_partition;
                        key             = a[ sorted_partition ];
                        while ( current_index && cmp( key, a[ current_index - 1 ] ) < 0 ) {
                            _exchange( a, current_index, current_index - 1 );
                            current_index -= 1;
                        }
                    }
                    return a;
                };
                
                _exchange       = function ( a, x, y ) {
                    DEBUG && console.log( "        _exchange called on %s, X: %s, Y: %s", a.print(), x, y );
                    var tmp = a[ x ];
                    a[ x ]  = a[ y ];
                    a[ y ]  = tmp;
                };

                return function ( cmp ) {
                    var tmp = this.slice();
                    if ( !cmp ) {
                        cmp = function ( a, b ) { return a - b; };
                    }
                    return _insertionsort( tmp, cmp );
                };
            }() );
        </script>

        <!--
          - YUI Test-based Unit Tests for insertionsort.
          -->
        <script>
            var ArrayAssert = YAHOO.util.ArrayAssert,
                Assert      = YAHOO.util.Assert;

            var tests   = new YAHOO.tool.TestCase( {
                name:   'InsertionSort Test',


                testOnePassEmptyArray: function() {
                    var tmp = [];
                    ArrayAssert.itemsAreEqual( [], tmp.insertionsort(), "An empty array, sorted, is empty." );
                },
                
                testOnePassSingleValueArray: function() {
                    var tmp = [ 1 ];
                    ArrayAssert.itemsAreEqual( [ 1 ], tmp.insertionsort(), "An one-element array, sorted, is sorted." );
                },

                testOnePassTwoValueArray: function() {
                    var tmp = [ 2, 1 ];
                    ArrayAssert.itemsAreEqual( [ 1, 2 ], tmp.insertionsort(), "An two-element array, sorted, is sorted." );
                },
                testOnePassThreeValueArray: function() {
                    var tmp = [ 2, 3, 1 ];
                    ArrayAssert.itemsAreEqual( [ 1, 2, 3 ], tmp.insertionsort(), "A three-element array, sorted, is sorted." );
                },

                testTwoPassThreeValueArray: function() {
                    var tmp = [ 3, 1, 2 ];
                    ArrayAssert.itemsAreEqual( [ 1, 2, 3 ], tmp.insertionsort(), "A three-element array, sorted, is sorted." );
                },

                testCmpFunction: function() {
                    var tmp = [ 3, 1, 2 ],
                        cmp = function ( a, b ) { return b - a; };
                    ArrayAssert.itemsAreEqual( [ 3, 2, 1 ], tmp.insertionsort( cmp ), "Custom comparison function ought behave correctly." );
                },

                testBigNastyRandomArray: function() {
                    var size = Math.floor( Math.random() * 100 ),
                        tmp  = [];

                    for ( i = 0; i<size; i++ ) {
                        tmp[ tmp.length ] = Math.floor( Math.random() * 100 );
                    }
                    var copy = tmp.slice( 0, tmp.length );
                    copy.sort( function (a, b) { return a-b; } );
                    ArrayAssert.itemsAreEqual( copy, tmp.insertionsort(), "A large, nasty random array ends up with the same results as `.sort`" );
                }
            } );
        </script>
    </head>
    <body>

        <script>
            var oLogger = new YAHOO.tool.TestLogger();
            YAHOO.tool.TestRunner.add( tests );
            YAHOO.tool.TestRunner.run();
        </script>
    </body>
</html>
