<!DOCTYPE HTML>
<html>
    <head>
        <title>Testbed for Quicksort Implementation</title>
        <!--
          - YUI Test Dependencies (YUI 2.8.0)
          -->
        <link rel="stylesheet" type="text/css" href="./yui/logger.css">
        <link rel="stylesheet" type="text/css" href="./yui/testlogger.css">
        <script type="text/javascript" src="./yui/yahoo-dom-event.js"></script>
        <script type="text/javascript" src="./yui/logger-min.js"></script>
        <script type="text/javascript" src="./yui/yuitest-min.js"></script>

        <!--
          - Quicksort Code: Based on discussion in "Introduction to Algorithms"
          -->
        <script>
            var DEBUG = false;

            /**
             *  Create a string to display the values of an array.
             *  
             *  I ran into timing issues with `console.log`'s Array display
             *  in webkit.  Rolling my own solves the problem (which I still
             *  don't actually understand...)
            **/
            Array.prototype.print = function() {
                var output = "[ ";
                for ( i = 0; i < this.length; i++ ) {
                    output += (( i ) ? ", " : "" ) + "`" + this[ i ] + "`";
                }
                output += " ]";
                return output;
            }
    
            Array.prototype.quicksort = ( function () {
                function _quicksort( a, start, end, cmp ) {
                    DEBUG && console.log( 'Called _quicksort with %s, Start: %d, End: %d', a.print(), start, end );
                    var pivot_index = null;
                    if ( start < end ) {
                        pivot_index = _partition( a, start, end, cmp );
                        _quicksort( a, start, pivot_index - 1, cmp );
                        _quicksort( a, pivot_index + 1, end, cmp );
                    }
                }

                function _partition( a, start, end, cmp ) {
                    DEBUG && console.log( 'Called _partition with %s, Start: %d, End: %d', a.print(), start, end );

                    // Randomize the last item of the array to reduce the risk
                    // of `O(n^2)` performance in the worst case.
                    _exchange( a, end, Math.floor( Math.random() * ( end - start ) + start ) );
                    
                    var pivot_value = a[ end ],
                        pivot_index = start - 1,
                        i           = null,
                        tmp         = null;

                    for ( i = start; i < end; i += 1 ) {
                        if ( cmp( a[ i ], pivot_value ) <= 0 ) {
                            pivot_index += 1;
                            _exchange( a, pivot_index, i );
                        }
                    }

                    pivot_index += 1;
                    _exchange( a, pivot_index, end );

                    DEBUG && console.log( "    _partition returning %d", pivot_index );
                    return pivot_index;
                }

                function _exchange( a, x, y ) {
                    DEBUG && console.log( "        _exchange called on %s, X: %s, Y: %s", a.print(), x, y );
                    var tmp = a[ x ];
                    a[ x ]  = a[ y ];
                    a[ y ]  = tmp;
                }

                return function( cmp ) {
                    // Copy the array with `.slice()`, leave original untouched.
                    var tmp = this.slice();
                    if ( !cmp ) {
                        cmp = function ( a, b ) { return a - b; };
                    }
                    _quicksort( tmp, 0, tmp.length - 1, cmp );
                    return tmp;
                };
            }() );
        </script>

        <!--
          - YUI Test-based Unit Tests for Quicksort.
          -->
        <script>
            var ArrayAssert = YAHOO.util.ArrayAssert,
                Assert      = YAHOO.util.Assert;

            var tests   = new YAHOO.tool.TestCase( {
                name:   'QuickSort Test',


                testOnePassEmptyArray: function() {
                    var tmp = [];
                    ArrayAssert.itemsAreEqual( [], tmp.quicksort(), "An empty array, sorted, is empty." );
                },
                
                testOnePassSingleValueArray: function() {
                    var tmp = [ 1 ];
                    ArrayAssert.itemsAreEqual( [ 1 ], tmp.quicksort(), "An one-element array, sorted, is sorted." );
                },

                testOnePassTwoValueArray: function() {
                    var tmp = [ 2, 1 ];
                    ArrayAssert.itemsAreEqual( [ 1, 2 ], tmp.quicksort(), "An two-element array, sorted, is sorted." );
                },
                testOnePassThreeValueArray: function() {
                    var tmp = [ 2, 3, 1 ];
                    ArrayAssert.itemsAreEqual( [ 1, 2, 3 ], tmp.quicksort(), "A three-element array, sorted, is sorted." );
                },

                testTwoPassThreeValueArray: function() {
                    var tmp = [ 3, 1, 2 ];
                    ArrayAssert.itemsAreEqual( [ 1, 2, 3 ], tmp.quicksort(), "A three-element array, sorted, is sorted." );
                },

                testCmpFunction: function() {
                    var tmp = [ 3, 1, 2 ],
                        cmp = function ( a, b ) { return b - a; };
                    ArrayAssert.itemsAreEqual( [ 3, 2, 1 ], tmp.quicksort( cmp ), "Custom comparison function ought behave correctly." );
                },

                testBigNastyRandomArray: function() {
                    var size = Math.floor( Math.random() * 10000 ),
                        tmp  = [];

                    for ( i = 0; i<size; i++ ) {
                        tmp[ tmp.length ] = Math.floor( Math.random() * 100 );
                    }
                    var copy = tmp.slice( 0, tmp.length );
                    copy.sort( function (a, b) { return a-b; } );
                    ArrayAssert.itemsAreEqual( copy, tmp.quicksort(), "A large, nasty random array ends up with the same results as `.sort`" );
                }
            } );
        </script>
    </head>
    <body>

        <script>
            var oLogger = new YAHOO.tool.TestLogger();
            YAHOO.tool.TestRunner.add( tests );
            YAHOO.tool.TestRunner.run();
        </script>
    </body>
</html>
